<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PLS Price + Time Lock</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* --------- CLEAN LIGHT THEME ---_------- */
    body {
      font-family: system-ui, sans-serif;
      background: #f5f9ff;
      color: #1a1a1a;
      margin: 0;
      padding: 16px;
    }

    h1, h2 {
      margin-top: 0;
      color: #003366;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      border: 1px solid #d0e0f0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .col {
      flex: 1 1 280px;
    }

    input, button {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #b2c8dd;
      background: #ffffff;
      color: #1a1a1a;
      font-size: 14px;
    }

    button {
      cursor: pointer;
      border: none;
      background: #1f7aec;
      color: #ffffff;
      font-weight: 600;
      transition: background 0.2s;
    }
    button:hover {
      background: #0059cc;
    }
    button[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .small {
      font-size: 12px;
      color: #466078;
    }

    /* Status tags */
    .tag {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #e6eff7;
      border: 1px solid #c6d8ea;
      margin-right: 6px;
      color: #003366;
      display: inline-block;
    }
    .status-ok { color: #007f3b; }
    .status-warn { color: #b38600; }
    .status-bad { color: #c62828; }

    /* Monospace address field */
    .mono {
      font-family: Courier, monospace;
      font-size: 13px;
      user-select: text !important;
      color: #003366;
    }

    /* Unlockable glow */
    .vault-card {
      transition: box-shadow 0.3s, border 0.3s;
    }
    .vault-unlockable {
      box-shadow: 0 0 16px 3px rgba(0,200,120,0.35);
      border: 1px solid #00b870 !important;
    }

    /* Copy-icon button */
    .copy-icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      border-radius: 6px;
      background: #1f7aec;
      cursor: pointer;
    }
    .copy-icon-btn:hover {
      background: #0059cc;
    }
    .copy-icon-btn svg {
      width: 16px;
      height: 16px;
      fill: white;
    }
    /*Pie Chart*/
    .price-goal-wrapper {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      gap:4px;
      min-width:90px;
    }
    
    .price-goal-pie {
      width:56px;
      height:56px;
      border-radius:50%;
      border:1px solid #000000;  /* black border */
      background:#ffffff;        /* white background by default */
    }

  </style>
</head>

<body>

  <h1 style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/PulseChainLogoTransparent.png/1200px-PulseChainLogoTransparent.png"
         alt="PLS"
         style="height:38px;width:auto;">
  
    <span>
      <b>PLS:    Price-mediated-unlock Vault, with timelock backup</b>
    </span>
  </h1>


  <div class="card">
    <!-- Network Prompt for switching to PulseChain -->
    <div id="networkPrompt" style="display: none; background-color: #f44336; color: white; padding: 10px; text-align: center; font-weight: bold;">
      ⚠️ Please switch to PulseChain (Chain ID: 369) in your wallet.<br>
      <span style="font-size: 13px; font-weight: normal;">
        In OKX Wallet: open <b>“DApp Connection”</b> and change network to <b>PulseChain</b>.
      </span>
    </div>
    <button id="connectBtn">Connect Wallet</button>
    <span id="walletAddress" class="mono"></span>
    <div id="networkInfo" class="small"></div>
  </div>

  <div class="card">
    <h2>About This App</h2>
    <div class="small">
      • Deposit PLS by sending it directly to the vault address.<br>
      • Withdraw when price OR backup time conditions are satisfied.<br><br>

      • Price feed: WPLS/DAI PulseX V1.<br>
      • Unlock logic: fully enforced on-chain.<br>
      • All vault metadata stored on-chain (recoverable).<br>
      • This UI stores vault addresses locally, safe to delete any time
        (does NOT affect the vault).
    </div>
  </div>

  <div class="row">
    <div class="col">
      <div class="card">
        <h2>Create New Lock</h2>

        <form id="createForm">
          <label>Target price (DAI per 1 PLS)</label>
          <input id="targetPrice" type="text" placeholder="0.0100" required />

          <label>Backup unlock date & time</label>
          <input id="unlockDateTime" type="datetime-local" required />

          <button id="createBtn" type="submit">Create Vault</button>
          <div id="createStatus" class="small"></div>
        </form>

      </div>
    </div>
  <!-- RIGHT COLUMN -->
    <div class="col">
      <div class="card">

        <h2>Global Price Feed (PulseX V1 WPLS/DAI)</h2>

        <div class="small" style="margin-bottom:6px;">
          Source: PulseX <b>V1</b> WPLS/DAI liquidity pool<br>
          Pair address:
        </div>

        <div style="display:flex;align-items:center;gap:6px;margin-bottom:12px;width:100%;max-width:420px;">
          <input class="mono"
                 value="0xe56043671df55de5cdf8459710433c10324de0ae"
                 readonly
                 style="
                   background:#ffffff;
                   color:#000000;
                   border:1px solid #ccd8e0;
                   width:100%;
                   padding:4px;
                   border-radius:6px;
                 " />

          <div class="copy-icon-btn" onclick="copyAddr('0xe56043671df55de5cdf8459710433c10324de0ae')">
            <svg viewBox="0 0 24 24">
              <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 
                       0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 
                       2-.9 2-2V7c0-1.1-.9-2-2-2zm0 
                       16H8V7h11v14z"/>
            </svg>
          </div>
        </div>

        <div id="globalPrice"></div>
        <div id="globalPriceRaw" class="small"></div>

      </div>
    </div>
  </div>
  
  <!-- ADD VAULT MANUALLY -->
  <div class="card">
    <h2>Add Vault Address Manually</h2>
    <input id="manualVaultInput" type="text" placeholder="0x..." style="width:70%;" />
    <button id="addVaultBtn">Add</button>
    <div id="manualAddStatus" class="small"></div>
  </div>

  <div class="card">
    <h2>Your Locks</h2>
    <div id="locksContainer" class="small">Connect wallet to load.</div>
  </div>

  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="app.js"></script>

</body>
</html>
